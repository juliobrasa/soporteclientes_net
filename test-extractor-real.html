<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Test Extractor Real</title>
</head>
<body>
    <h1>Test del Extractor con Sesi√≥n Real</h1>
    
    <div>
        <button id="loginFirst">1. Iniciar Sesi√≥n Admin</button>
        <button id="testExtraction">2. Probar Extracci√≥n</button>
        <div id="results"></div>
    </div>

    <script>
    const results = document.getElementById('results');
    
    document.getElementById('loginFirst').onclick = function() {
        // Redirigir a login admin
        window.location.href = '/admin-login.php';
    };
    
    document.getElementById('testExtraction').onclick = async function() {
        results.innerHTML = '<p>üîÑ Probando extracci√≥n...</p>';
        
        const testData = {
            hotel_id: 6,  // Cambiado de hotel_ids a hotel_id (singular)
            max_reviews: 200,
            platforms: ['booking'],
            languages: ['en', 'es']
            // Eliminado extraction_mode - no lo usa el API
        };
        
        try {
            const response = await fetch('/api-extraction.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
                    // NO env√≠o X-Admin-Session - deber√≠a usar cookie autom√°ticamente
                },
                credentials: 'same-origin', // IMPORTANTE: incluir cookies
                body: JSON.stringify(testData)
            });
            
            results.innerHTML += `<p>üìä HTTP Status: ${response.status}</p>`;
            
            const responseText = await response.text();
            results.innerHTML += `<p>üìã Response: <pre>${responseText}</pre></p>`;
            
            if (response.ok) {
                const data = JSON.parse(responseText);
                results.innerHTML += `<p>‚úÖ √âxito: ${JSON.stringify(data, null, 2)}</p>`;
            } else {
                results.innerHTML += `<p>‚ùå Error ${response.status}: ${responseText}</p>`;
            }
            
        } catch (error) {
            results.innerHTML += `<p>üí• Error de red: ${error.message}</p>`;
        }
    };
    </script>
</body>
</html>