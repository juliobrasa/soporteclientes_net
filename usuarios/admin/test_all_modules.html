<!DOCTYPE html>
<html>
<head>
    <title>Test All Modules</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .test-container { max-width: 1200px; margin: 0 auto; }
        .module-test { background: white; margin: 20px 0; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .test-result { margin-top: 10px; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .btn { padding: 8px 16px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-info { background: #17a2b8; color: white; }
        .module-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="test-container">
        <h1>üß™ Test de Todos los M√≥dulos - Kavia Admin Panel</h1>
        <p>Prueba de funcionamiento de todos los m√≥dulos activados</p>
        
        <div style="margin-bottom: 20px;">
            <button onclick="testAllModules()" class="btn btn-primary">üöÄ Probar Todos los M√≥dulos</button>
            <button onclick="testConnection()" class="btn btn-info">üîó Test Conexi√≥n API</button>
            <button onclick="clearResults()" class="btn btn-success">üßπ Limpiar Resultados</button>
        </div>
        
        <div class="module-grid" id="test-results">
            <!-- Los resultados se mostrar√°n aqu√≠ -->
        </div>
    </div>

    <script>
        // Configuraci√≥n m√≠nima para compatibilidad
        window.AdminConfig = {
            debug: { enabled: true },
            api: { baseUrl: 'admin_api.php' }
        };
        
        // Mock de funciones necesarias
        window.apiClient = {
            async getHotels() {
                const response = await fetch('admin_api.php?action=getHotels');
                return await response.json();
            }
        };
        
        function testAllModules() {
            const modules = [
                { name: 'Hotels', id: 'hotels', icon: 'fa-hotel', color: '#007bff' },
                { name: 'APIs Externas', id: 'apis', icon: 'fa-plug', color: '#17a2b8' },
                { name: 'Extracci√≥n', id: 'extraction', icon: 'fa-download', color: '#ffc107' },
                { name: 'Proveedores IA', id: 'providers', icon: 'fa-server', color: '#dc3545' },
                { name: 'Prompts', id: 'prompts', icon: 'fa-comment-alt', color: '#6f42c1' },
                { name: 'Analytics & Logs', id: 'logs', icon: 'fa-chart-bar', color: '#fd7e14' }
            ];
            
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '';
            
            modules.forEach(module => {
                const moduleDiv = document.createElement('div');
                moduleDiv.className = 'module-test';
                moduleDiv.innerHTML = `
                    <h3 style="color: ${module.color};">
                        <i class="fas ${module.icon}"></i> ${module.name}
                    </h3>
                    <div id="result-${module.id}" class="test-result warning">
                        <i class="fas fa-spinner fa-spin"></i> Probando m√≥dulo...
                    </div>
                `;
                resultsDiv.appendChild(moduleDiv);
                
                // Probar cada m√≥dulo
                setTimeout(() => {
                    testModule(module.id, module.name);
                }, 100 * modules.indexOf(module));
            });
        }
        
        async function testModule(moduleId, moduleName) {
            const resultDiv = document.getElementById(`result-${moduleId}`);
            
            try {
                let success = false;
                let message = '';
                
                switch(moduleId) {
                    case 'hotels':
                        // Test de hoteles con llamada real a API
                        try {
                            const response = await fetch('admin_api.php?action=getHotels');
                            const data = await response.json();
                            if (data.success && data.hotels) {
                                success = true;
                                message = `‚úÖ ${data.hotels.length} hoteles cargados correctamente`;
                            } else {
                                message = `‚ùå Error: ${data.error || 'No se pudieron cargar hoteles'}`;
                            }
                        } catch (error) {
                            message = `‚ùå Error de conexi√≥n: ${error.message}`;
                        }
                        break;
                        
                    case 'apis':
                        // Test directo del sistema de APIs
                        if (typeof window.loadApisDirect === 'function') {
                            success = true;
                            message = '‚úÖ Sistema directo de APIs funcionando';
                        } else {
                            message = '‚ùå Funci√≥n loadApisDirect no encontrada';
                        }
                        break;
                        
                    case 'extraction':
                        // Test directo del sistema de Extracci√≥n
                        if (typeof window.loadExtractionDirect === 'function') {
                            success = true;
                            message = '‚úÖ Sistema directo de Extracci√≥n funcionando';
                        } else {
                            message = '‚ùå Funci√≥n loadExtractionDirect no encontrada';
                        }
                        break;
                        
                    case 'providers':
                        // Test directo del sistema de Proveedores
                        if (typeof window.loadProvidersDirect === 'function') {
                            success = true;
                            message = '‚úÖ Sistema directo de Proveedores funcionando';
                        } else {
                            message = '‚ùå Funci√≥n loadProvidersDirect no encontrada';
                        }
                        break;
                        
                    case 'prompts':
                        // Test directo del sistema de Prompts
                        if (typeof window.loadPromptsDirect === 'function') {
                            success = true;
                            message = '‚úÖ Sistema directo de Prompts funcionando';
                        } else {
                            message = '‚ùå Funci√≥n loadPromptsDirect no encontrada';
                        }
                        break;
                        
                    case 'logs':
                        // Test directo del sistema de Logs
                        if (typeof window.loadLogsDirect === 'function') {
                            success = true;
                            message = '‚úÖ Sistema directo de Logs funcionando';
                        } else {
                            message = '‚ùå Funci√≥n loadLogsDirect no encontrada';
                        }
                        break;
                }
                
                resultDiv.className = `test-result ${success ? 'success' : 'error'}`;
                resultDiv.innerHTML = message;
                
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.innerHTML = `‚ùå Error en test: ${error.message}`;
            }
        }
        
        async function testConnection() {
            const resultDiv = document.createElement('div');
            resultDiv.className = 'module-test';
            resultDiv.innerHTML = `
                <h3><i class="fas fa-wifi"></i> Test de Conexi√≥n</h3>
                <div id="connection-result" class="test-result warning">
                    <i class="fas fa-spinner fa-spin"></i> Probando conexi√≥n...
                </div>
            `;
            
            const resultsContainer = document.getElementById('test-results');
            resultsContainer.insertBefore(resultDiv, resultsContainer.firstChild);
            
            try {
                const response = await fetch('admin_api.php?action=getHotels');
                const data = await response.json();
                
                const connectionResult = document.getElementById('connection-result');
                if (data.success) {
                    connectionResult.className = 'test-result success';
                    connectionResult.innerHTML = `‚úÖ Conexi√≥n exitosa - API respondiendo correctamente`;
                } else {
                    connectionResult.className = 'test-result error';
                    connectionResult.innerHTML = `‚ùå Error en API: ${data.error}`;
                }
            } catch (error) {
                const connectionResult = document.getElementById('connection-result');
                connectionResult.className = 'test-result error';
                connectionResult.innerHTML = `‚ùå Error de conexi√≥n: ${error.message}`;
            }
        }
        
        function clearResults() {
            document.getElementById('test-results').innerHTML = '';
        }
        
        // Auto-test cuando se carga la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üß™ Test page loaded - ready for testing');
        });
    </script>
    
    <!-- Cargar funciones directas desde admin_main.php -->
    <script src="admin_main.php"></script>
</body>
</html>